<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–®å­—è¨˜æ†¶å¡ (Flashcards)</title>
    <!-- å¼•å…¥ Tailwind CSS (CDN) ç”¨æ–¼å¿«é€Ÿæ’ç‰ˆ [web:1][web:4] -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾©éŒ¯èª¤æ–æ™ƒå‹•ç•« */
        .shake {
            animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800 font-sans">

    <div class="max-w-2xl mx-auto py-8 px-4">
        <!-- æ¨™é¡Œèˆ‡å°èˆª -->
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-600 mb-4">ğŸ“ å–®å­—è¨˜æ†¶å¡</h1>
            <div class="inline-flex bg-white rounded-lg shadow p-1">
                <button onclick="switchTab('quiz')" id="btn-quiz" class="px-6 py-2 rounded-md text-sm font-medium transition-colors bg-blue-500 text-white">
                    æ¸¬é©—æ¨¡å¼
                </button>
                <button onclick="switchTab('manage')" id="btn-manage" class="px-6 py-2 rounded-md text-sm font-medium transition-colors text-gray-600 hover:bg-gray-50">
                    å–®å­—ç®¡ç†
                </button>
            </div>
        </header>

        <!-- æ¸¬é©—æ¨¡å¼å€å¡Š -->
        <main id="view-quiz" class="space-y-6">
            <div class="bg-white rounded-xl shadow-md p-8 text-center relative overflow-hidden">
                
                <!-- é¡Œç›®é¡¯ç¤ºå€ -->
                <div id="quiz-card" class="mb-8">
                    <span id="quiz-pos" class="inline-block bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mb-2">è©æ€§</span>
                    <h2 id="quiz-meaning" class="text-4xl font-bold text-gray-800 mb-6">ä¸­æ–‡æ„æ€</h2>
                    
                    <!-- è¼¸å…¥æ¡† -->
                    <div class="relative max-w-md mx-auto">
                        <input type="text" 
                               id="quiz-input" 
                               placeholder="è«‹è¼¸å…¥è‹±æ–‡æ‹¼å­—..." 
                               class="w-full text-center text-2xl border-b-4 border-gray-300 focus:border-blue-500 outline-none py-2 bg-transparent transition-colors"
                               autocomplete="off">
                        <p id="error-msg" class="text-red-500 text-sm mt-2 h-5 opacity-0 transition-opacity font-bold">æ‹¼å­—éŒ¯èª¤ï¼</p>
                    </div>
                </div>

                <!-- çµæœåé¥‹å€ -->
                <div id="result-area" class="hidden">
                    <div class="text-green-600 text-xl font-bold mb-4">ğŸ‰ ç­”å°äº†ï¼ <span id="answer-display"></span></div>
                    <button onclick="nextQuestion()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-semibold shadow transition-transform hover:scale-105">
                        ä¸‹ä¸€é¡Œ (Enter)
                    </button>
                </div>

                <div id="empty-state" class="hidden text-gray-500">
                    ç›®å‰æ²’æœ‰å–®å­—ï¼Œè«‹å…ˆè‡³ã€Œå–®å­—ç®¡ç†ã€æ–°å¢ã€‚
                </div>
            </div>
            
            <div class="text-center text-gray-400 text-sm">
                æç¤ºï¼šè¼¸å…¥éŒ¯èª¤æ™‚è¼¸å…¥æ¡†æœƒè®Šç´…ã€‚
            </div>
        </main>

        <!-- å–®å­—ç®¡ç†å€å¡Š -->
        <main id="view-manage" class="hidden space-y-6">
            <!-- æ–°å¢å–®å­—è¡¨å–® -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold mb-4 border-b pb-2">æ–°å¢å–®å­—</h3>
                <form id="add-form" class="grid grid-cols-1 gap-4 md:grid-cols-4">
                    <input type="text" id="input-spelling" placeholder="è‹±æ–‡æ‹¼å­— (e.g. Apple)" required 
                           class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-200 outline-none">
                    <input type="text" id="input-meaning" placeholder="ä¸­æ–‡æ„æ€ (e.g. è˜‹æœ)" required 
                           class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-200 outline-none">
                    <input type="text" id="input-pos" placeholder="è©æ€§ (e.g. n.)" required 
                           class="border rounded px-3 py-2 focus:ring-2 focus:ring-blue-200 outline-none">
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors">
                        æ–°å¢
                    </button>
                </form>
            </div>

            <!-- å–®å­—åˆ—è¡¨ -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 border-b">
                                <th class="p-4 font-semibold text-gray-600">è‹±æ–‡</th>
                                <th class="p-4 font-semibold text-gray-600">ä¸­æ–‡</th>
                                <th class="p-4 font-semibold text-gray-600">è©æ€§</th>
                                <th class="p-4 font-semibold text-gray-600 w-20">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="word-list-body" class="divide-y divide-gray-100">
                            <!-- JS å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
                        </tbody>
                    </table>
                </div>
                <div id="list-empty-msg" class="p-8 text-center text-gray-500 hidden">
                    æš«ç„¡å–®å­—ï¼Œå¿«å»æ–°å¢å§ï¼
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- 1. è³‡æ–™èˆ‡ç‹€æ…‹ç®¡ç† ---
        const STORAGE_KEY = 'vocab_cards_data';
        let words = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let currentWord = null;

        // --- 2. åˆå§‹åŒ–èˆ‡äº‹ä»¶ç›£è½ ---
        document.addEventListener('DOMContentLoaded', () => {
            renderList();
            if (words.length > 0) nextQuestion();
            else showEmptyState();
            
            // ç¶å®šæ–°å¢è¡¨å–®
            document.getElementById('add-form').addEventListener('submit', handleAddWord);
            
            // ç¶å®šè¼¸å…¥æ¡†å³æ™‚æª¢æŸ¥ [web:10][web:12]
            const input = document.getElementById('quiz-input');
            input.addEventListener('input', handleInputCheck);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !document.getElementById('result-area').classList.contains('hidden')) {
                    nextQuestion();
                }
            });
        });

        // --- 3. æ ¸å¿ƒé‚è¼¯ï¼šå³æ™‚æª¢æŸ¥ ---
        function handleInputCheck(e) {
            if (!currentWord) return;

            const inputVal = e.target.value.trim(); // ä¸è½‰å°å¯«ï¼Œä¿ç•™å¤§å°å¯«ç·´ç¿’ï¼Œæˆ–è¦–éœ€æ±‚ e.target.value.toLowerCase()
            const target = currentWord.spelling;
            const errorMsg = document.getElementById('error-msg');
            const inputEl = e.target;

            // é‚è¼¯ A: å®Œå…¨åŒ¹é… -> æˆåŠŸ
            if (inputVal === target) {
                showSuccess();
                return;
            }

            // é‚è¼¯ B: å‰ç¶´æª¢æŸ¥ (å³æ™‚éŒ¯èª¤åé¥‹)
            // å¦‚æœä½¿ç”¨è€…è¼¸å…¥çš„å…§å®¹ä¸æ˜¯ç›®æ¨™å–®å­—çš„å‰ç¶´ (ä¾‹å¦‚ target: apple, input: apx)ï¼Œå‰‡å ±éŒ¯
            if (!target.startsWith(inputVal)) {
                inputEl.classList.add('border-red-500', 'text-red-600', 'shake');
                inputEl.classList.remove('border-gray-300', 'focus:border-blue-500');
                errorMsg.classList.remove('opacity-0');
                
                // å‹•ç•«é‡ç½® hack
                setTimeout(() => inputEl.classList.remove('shake'), 300);
            } else {
                // è¼¸å…¥æ­£ç¢ºä½†æœªå®Œæˆ
                resetInputStyles(inputEl);
            }
        }

        function resetInputStyles(el) {
            el.classList.remove('border-red-500', 'text-red-600', 'border-green-500', 'text-green-600');
            el.classList.add('border-gray-300', 'focus:border-blue-500');
            document.getElementById('error-msg').classList.add('opacity-0');
        }

        function showSuccess() {
            const inputEl = document.getElementById('quiz-input');
            inputEl.classList.remove('border-gray-300', 'focus:border-blue-500', 'border-red-500', 'text-red-600');
            inputEl.classList.add('border-green-500', 'text-green-600'); // æˆåŠŸç¶ è‰²
            inputEl.disabled = true;

            document.getElementById('answer-display').textContent = currentWord.spelling;
            document.getElementById('result-area').classList.remove('hidden');
            // è‡ªå‹•èšç„¦åˆ°æŒ‰éˆ•ä»¥ä¾¿ Enter ä¸‹ä¸€é¡Œ
            document.querySelector('#result-area button').focus(); 
        }

        // --- 4. æ¸¬é©—æµç¨‹æ§åˆ¶ ---
        function nextQuestion() {
            if (words.length === 0) return;

            // éš¨æ©Ÿé¸é¡Œ
            const randomIndex = Math.floor(Math.random() * words.length);
            currentWord = words[randomIndex];

            // UI é‡ç½®
            const inputEl = document.getElementById('quiz-input');
            inputEl.value = '';
            inputEl.disabled = false;
            resetInputStyles(inputEl);
            inputEl.focus();

            document.getElementById('quiz-meaning').textContent = currentWord.meaning;
            document.getElementById('quiz-pos').textContent = currentWord.pos;
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('empty-state').classList.add('hidden');
            document.getElementById('quiz-card').classList.remove('hidden');
        }

        function showEmptyState() {
            document.getElementById('quiz-card').classList.add('hidden');
            document.getElementById('empty-state').classList.remove('hidden');
        }

        // --- 5. å–®å­—ç®¡ç†é‚è¼¯ ---
        function handleAddWord(e) {
            e.preventDefault();
            const spelling = document.getElementById('input-spelling').value.trim();
            const meaning = document.getElementById('input-meaning').value.trim
